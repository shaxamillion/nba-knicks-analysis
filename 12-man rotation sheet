library(ggplot2)
library(dplyr)
library(tidyr)

# All 78 lineups in order
lineups <- c(
  "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", 
  "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT",
  "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT",
  "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT",
  "Brunson-Bridges-Diawara-Yabusele-Hukporti", "Brunson-Bridges-Diawara-Yabusele-Hukporti",
  "Brunson-Bridges-Diawara-Yabusele-Hukporti", "Brunson-Bridges-Diawara-Yabusele-Hukporti",
  "Brunson-Clarkson-OG-Yabusele-Hukporti", "Brunson-Clarkson-OG-Yabusele-Hukporti",
  "Brunson-Clarkson-OG-Yabusele-Hukporti", "Brunson-Clarkson-OG-Yabusele-Hukporti",
  "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT",
  "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-McBride-Bridges-OG-KAT", "Kolek-McBride-McCullar-OG-KAT",
  "Kolek-McBride-McCullar-OG-KAT", "Kolek-McBride-McCullar-OG-Yabusele", "Kolek-McBride-McCullar-OG-Yabusele",
  "Kolek-McBride-McCullar-OG-Yabusele", "Kolek-McBride-McCullar-OG-Yabusele", "Kolek-McBride-McCullar-Yabusele-Hukporti",
  "Kolek-McBride-McCullar-Yabusele-Hukporti", "Brunson-McBride-Bridges-Yabusele-Hukporti",
  "Brunson-McBride-Bridges-Yabusele-Hukporti", "Brunson-McBride-Bridges-Yabusele-Hukporti",
  "Brunson-Bridges-Diawara-Yabusele-Hukporti", "Brunson-Bridges-OG-Diawara-Hukporti",
  "Brunson-Bridges-OG-Diawara-Hukporti", "Brunson-Bridges-OG-Diawara-Hukporti", "Brunson-Bridges-OG-Diawara-Hukporti",
  "Brunson-Bridges-OG-Diawara-Hukporti", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT",
  "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT", "Brunson-Bridges-OG-Diawara-KAT",
  "Brunson-McCullar-Bridges-OG-KAT", "Brunson-McCullar-Bridges-OG-KAT", "Brunson-McBride-McCullar-OG-Jemison",
  "Brunson-McBride-McCullar-Yabusele-Jemison", "Brunson-McBride-McCullar-Yabusele-Jemison",
  "Brunson-McBride-McCullar-Yabusele-Jemison", "Brunson-McBride-McCullar-Yabusele-Jemison",
  "Brunson-Clarkson-McBride-Yabusele-Jemison", "Brunson-Clarkson-McBride-Yabusele-Jemison",
  "Brunson-Clarkson-McBride-Yabusele-Jemison", "Brunson-Clarkson-McBride-Yabusele-Jemison",
  "Brunson-Clarkson-McBride-OG-KAT", "Brunson-Clarkson-McBride-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT",
  "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT",
  "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT", "Kolek-Clarkson-Bridges-OG-KAT",
  "Kolek-Clarkson-McBride-OG-KAT", "Kolek-Clarkson-McBride-OG-KAT", "Brunson-McBride-Bridges-OG-KAT",
  "Brunson-McBride-Bridges-OG-KAT", "Brunson-McBride-Bridges-Yabusele-KAT", "Brunson-McBride-Bridges-OG-KAT",
  "Brunson-McBride-Bridges-OG-KAT", "Brunson-McBride-Bridges-OG-KAT", "Brunson-McBride-Bridges-OG-KAT",
  "Brunson-McBride-Bridges-OG-KAT", "Brunson-McBride-Bridges-OG-KAT"
)

# Parse each lineup
parse_lineup <- function(lineup) {
  players <- strsplit(lineup, "-")[[1]]
  c(
    Brunson = as.integer("Brunson" %in% players),
    McBride = as.integer("McBride" %in% players),
    Clarkson = as.integer("Clarkson" %in% players),
    Bridges = as.integer("Bridges" %in% players),
    OG = as.integer("OG" %in% players),
    Diawara = as.integer("Diawara" %in% players),
    Yabusele = as.integer("Yabusele" %in% players),
    Hukporti = as.integer("Hukporti" %in% players),
    KAT = as.integer("KAT" %in% players),
    McCullar = as.integer("McCullar" %in% players),
    Jemison = as.integer("Jemison" %in% players),
    Kolek = as.integer("Kolek" %in% players)
  )
}

# Create data frame
lineup_matrix <- t(sapply(lineups, parse_lineup))
lineup_data <- as.data.frame(lineup_matrix)
lineup_data$Possession <- 1:78

# Reshape for plotting
lineup_long <- lineup_data %>%
  pivot_longer(cols = -Possession, names_to = "Player", values_to = "On_Court") %>%
  filter(On_Court == 1)

# Set player order
player_order <- c("Brunson", "McBride", "Clarkson", "Bridges", "OG", "Diawara",
                  "Yabusele", "Hukporti", "KAT", "McCullar", "Jemison", "Kolek")
lineup_long$Player <- factor(lineup_long$Player, levels = rev(player_order))

# Create the chart with enhanced visual design
ggplot(lineup_long, aes(x = Possession, y = Player, fill = Player)) +
  # Add subtle shadow effect with multiple layers
  geom_tile(aes(alpha = 0.3), color = NA, size = 0, width = 0.98, height = 0.88, 
            position = position_nudge(x = 0.15, y = -0.08)) +
  
  # Main tiles with white borders
  geom_tile(color = "white", size = 1.2, width = 0.95, height = 0.85, alpha = 0.95) +
  
  # Add glossy highlight effect on top
  geom_tile(aes(alpha = 0.15), fill = "white", color = NA, 
            width = 0.95, height = 0.4, position = position_nudge(y = 0.2)) +
  
  # Enhanced color scheme with more vibrant colors
  scale_fill_manual(
    values = c(
      "Brunson" = "#0051BA",    # Deeper Knicks blue
      "McBride" = "#FF6B35",    # Bright orange
      "Clarkson" = "#A855F7",   # Vibrant purple
      "Bridges" = "#06B6D4",    # Cyan
      "OG" = "#10B981",         # Emerald green
      "Diawara" = "#EF4444",    # Bright red
      "Yabusele" = "#F59E0B",   # Amber
      "Hukporti" = "#14B8A6",   # Teal
      "KAT" = "#1E293B",        # Slate
      "McCullar" = "#EA580C",   # Deep orange
      "Jemison" = "#6B7280",    # Cool gray
      "Kolek" = "#7C3AED"       # Violet
    )
  ) +
  
  scale_alpha_identity() +
  
  # Add possession milestone markers
  geom_vline(xintercept = c(20, 40, 60), linetype = "dotted", 
             color = "#CBD5E1", size = 0.8, alpha = 0.6) +
  
  labs(
    title = "What Does a 12-Man Rotation Look Like?",
    subtitle = "Half-Court Offensive Possessions vs NOP • 78 Total Possessions • 12/29/2025",
    x = "Possession Number",
    y = NULL
  ) +
  
  scale_x_continuous(breaks = seq(0, 80, 10), expand = c(0.01, 0)) +
  
  theme_minimal(base_size = 14, base_family = "sans") +
  theme(
    plot.background = element_rect(fill = "#FAFAF8", color = NA),
    panel.background = element_rect(fill = "#FAFAF8", color = NA),
    panel.grid.major.x = element_line(color = "#E5E7EB", size = 0.4, linetype = "solid"),
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank(),
    
    plot.title = element_text(
      size = 24, 
      face = "bold", 
      hjust = 0.5, 
      color = "#1E293B",
      margin = margin(b = 8, t = 15),
      family = "sans"
    ),
    plot.subtitle = element_text(
      size = 12, 
      hjust = 0.5, 
      color = "#64748B",
      margin = margin(b = 25),
      family = "sans"
    ),
    
    axis.title.x = element_text(
      size = 12, 
      face = "bold", 
      color = "#475569",
      margin = margin(t = 15)
    ),
    axis.text.x = element_text(size = 10, color = "#64748B", face = "bold"),
    axis.text.y = element_text(size = 12, color = "#1E293B", face = "bold", 
                               margin = margin(r = 10)),
    
    legend.position = "none",
    
    plot.margin = margin(25, 25, 25, 25),
    
    # Add subtle border around the entire plot
    panel.border = element_rect(color = "#E5E7EB", fill = NA, size = 0.5)
  ) +
  
  # Enhanced corner note with box
  annotate("rect", xmin = 59, xmax = 77.5, ymin = 0.2, ymax = 0.8,
           fill = "white", color = "#E5E7EB", size = 0.5, alpha = 0.9) +
  annotate("text", x = 68.25, y = 0.5, 
           label = "Data & Visual by ShaxNBA",
           hjust = 0.5, size = 3.2, color = "#64748B", fontface = "bold.italic")

print(last_plot())
